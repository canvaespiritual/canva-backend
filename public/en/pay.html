<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Get Your Report â€” Soul Map</title>
  <meta name="description" content="Watch the brief instruction and unlock your personalized Soul Map report." />

  <style>
    :root{
      --bg:#0b0b0c; --fg:#f5f5f5; --muted:#9ca3af; --card:#131316; --ok:#16a34a; --maxw:960px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:20px 14px}
    .center{text-align:center}
    .card{background:var(--card);border:1px solid #1f2126;border-radius:14px;padding:18px}
    .hint{color:var(--muted);font-size:.95rem}
    .hidden{display:none!important}

    .player-box{position:relative;background:#000;border-radius:14px;overflow:hidden;box-shadow:0 14px 36px rgba(0,0,0,.45)}
    .ratio{height:0;padding-top:177.7777%} /* 9:16 */
    .player-abs{position:absolute;inset:0}
    .player-abs vturb-smartplayer{position:absolute;inset:0;width:100%;height:100%;display:block}

    .btn{
      appearance:none;border:0;border-radius:999px;padding:14px 22px;cursor:pointer;
      background:var(--ok);color:#fff;font-weight:800;letter-spacing:.2px;
      box-shadow:0 12px 28px rgba(22,163,74,.25);
    }
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    @media (min-width: 1024px) {
  /* limita a coluna do vÃ­deo */
  .player-box {
    max-height: 650px; /* vocÃª pode ajustar: 580, 600, 680... */
    margin-bottom: 0;
  }

  /* reduz o espaÃ§o vertical preto */
  .ratio {
    padding-top: 90% !important;  /* antes 177% â†’ agora ENCOLHE */
  }

  /* garante que o bloco "solidÃ¡rio" suba */
  #solidario {
    margin-top: 20px !important;
  }
}
  </style>
    <script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '208458446274723');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=208458446274723&ev=PageView&noscript=1"/></noscript>
<!-- End Meta Pixel Code -->

<!-- Evento desta pÃ¡gina: Lead (chegou ao checkout) -->
<script>
  fbq('track', 'Lead', {
    content_name: 'Checkout - Quiz',
    content_category: 'quiz_checkout'
  });
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QDEN04CQM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // Configura o GA4 com seu ID
  gtag('config', 'G-9QDEN04CQM');
  // Config Google Ads
  gtag('config', 'AW-936695843');

  // ConversÃ£o: Lead Quiz
  gtag('event', 'conversion', {
    'send_to': 'AW-936695843/rusXCK68ipcbEKOw074D'
  });
</script>


  <script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "tg0bonz3au");
</script>
</head>
<body>
  <main class="wrap">
    <header class="center" style="margin:6px 0 16px">
      <h1 style="margin:0 0 4px;font-size:22px;line-height:1.2">Your report is almost ready</h1>
      <p class="hint">Watch the brief instruction and unlock your self-diagnosis on this page.</p>
    </header>

    <!-- PLAYER -->
    <section class="player-box">
      <div class="ratio" id="ratioBox"></div>
      <div class="player-abs" id="vturbMount"></div>
    </section>

    <!-- CONTRIBUTION -->
    <section id="solidario" class="hidden" style="max-width:520px;margin:24px auto 0;padding:0 12px;text-align:center">
      <h3 style="margin:0 0 8px;font:800 18px/1.2 system-ui">ğŸ’› Choose your contribution</h3>
      <p style="margin:0 0 12px;color:#9ca3af;font:14px system-ui">
        Together, we spread more emotional mastery â€” and fewer addictions, meds, betting and escapes.
      </p>

      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:10px">
        <button class="chip" data-v="9" title="ğŸŒ± Seed" style="padding:8px 12px;border-radius:999px;border:1px solid #d1d5db;background:#fff;cursor:pointer">$9</button>
        <button class="chip" data-v="19" title="ğŸ”º Committed" style="padding:8px 12px;border-radius:999px;border:1px solid #d1d5db;background:#fff;cursor:pointer">$19</button>
        <button class="chip" data-v="29" title="ğŸ”¥ Transforming" style="padding:8px 12px;border-radius:999px;border:1px solid #d1d5db;background:#fff;cursor:pointer">$29</button>
        <button class="chip" data-v="49" title="ğŸŒ• Complete" style="padding:8px 12px;border-radius:999px;border:1px solid #d1d5db;background:#fff;cursor:pointer">$49</button>
      </div>

      <p id="tiersRow" style="margin:2px 0 10px;color:#cbd5e1;font:12.5px system-ui">
        ğŸŒ± <strong>Seed Donor</strong> â€¢ ğŸ”º <strong>Committed Donor</strong> â€¢ ğŸ”¥ <strong>Transforming Donor</strong> â€¢ ğŸŒ• <strong>Complete Patron</strong>
      </p>
      <p id="impactLine" style="margin:-2px 0 12px;color:#9ca3af;font:12px system-ui">
        Every <strong>$5</strong> helps us reach about <strong>1,000 new people</strong>.
      </p>
      <p id="tierExplain" style="margin:-6px 0 12px;color:#a3b2c2;font:12px system-ui">
        ğŸŒ± <strong>Seed Donor</strong> â€” You keep the light on.
      </p>

      <div style="display:flex;gap:8px;justify-content:center;align-items:center;margin-bottom:8px">
        <label for="valorSolidario" style="color:#f5f5f5;font:600 14px system-ui">Amount:</label>
        <input id="valorSolidario" type="number" min="9" max="500" step="1" value="1" inputmode="numeric"
               style="width:120px;text-align:center;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;color:#111827;font:700 16px system-ui">
      </div>

      <button id="solidarioBtn" class="btn">Contribute $10 â†’</button>
      <p style="margin:8px 0 0;color:#9ca3af;font:12px system-ui">
        <span style="display:inline-flex;align-items:center;gap:6px">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 10V8a6 6 0 1112 0v2m-9 4h6m-9 0a3 3 0 01-3-3V9a2 2 0 012-2h12a2 2 0 012 2v2a3 3 0 01-3 3m-9 0v2a3 3 0 003 3h3a3 3 0 003-3v-2" stroke="#9ca3af" stroke-width="1.3" stroke-linecap="round"/></svg>
          Secure checkout on the next page via <strong>Stripe</strong>. We never store card details.
        </span>
      </p>
    </section>

    <!-- WHAT YOU'LL RECEIVE -->
    <section id="receiveBlock" class="card hidden" style="max-width:720px;margin:22px auto 0">
      <h3 style="margin:0 0 10px;font:800 18px/1.2 system-ui">Youâ€™ll receive</h3>
      <ul style="margin:0 0 8px 18px;line-height:1.55">
        <li>ğŸ§­ Bodyâ€“Mindâ€“Spirit Diagnosis</li>
        <li>ğŸŒˆ For those seeking full alignment between essence, health, and purpose.</li>
        <li>âœ”ï¸ Soul reflection (12 main mirrors)</li>
        <li>âœ”ï¸ Reflection in family life</li>
        <li>âœ”ï¸ Reflection in social life</li>
        <li>âœ”ï¸ Reflection in professional life</li>
        <li>âœ”ï¸ Dominant archetype (technical & symbolic)</li>
        <li>âœ”ï¸ Personalized elevation exercise</li>
        <li>ğŸ”“ Sensory triggers (smell, vision, touch, taste, hearing)</li>
        <li>ğŸ”“ Soul Map (12 faces and 12 levels)</li>
        <li>ğŸ”“ Personalized spiritual reflection</li>
        <li>ğŸ”“ General elevation protocol</li>
        <li>ğŸ” Spirit Map (10 faces and 13 levels)</li>
        <li>ğŸ” Physical & behavioral signs</li>
        <li>ğŸ” Physiological predispositions (short & long term)</li>
        <li>ğŸ” Mental health predispositions (short & long term)</li>
        <li>ğŸ Bonus class â€” The Engineering of Spiritual Disconnection (ğŸ¥ Videodiagnostic of the age of distraction, addiction & inner fragmentation)</li>
      </ul>
    </section>
  </main>

  <script>
    (function stopAmbientAudio() {
    try {
      const musica = document.getElementById('musicaAmbiente');
      if (musica) {
        musica.pause();
        musica.currentTime = 0;
      }
    } catch (e) {
      console.warn('NÃ£o foi possÃ­vel parar o Ã¡udio ambiente:', e);
    }
  })();
  document.addEventListener("DOMContentLoaded", () => {
    /* =================== CONFIG =================== */
    const VTURB_ACCOUNT_ID = 'ab0d5dbd-353e-4147-a5c6-52ab96121828';
    const VTURB_PLAYER_ID  = '6921afb3e478a90f43adb12f';
    const ASPECT_RATIO     = '9:16';
    

    // Gate (seconds of watched/started)
    const UNLOCK_CONTRIB_SECONDS = 559;
    const UNLOCK_REPORT_SECONDS  = 539;
    const STORAGE_KEY = 'vsl_unlocked_en_v1';
    const STORAGE_KEY_LOCAL = 'vsl_unlocked_en_v1_local';

    /* ============================================== */

    // Ratio
    const rb = document.getElementById('ratioBox');
    if (rb) rb.style.paddingTop = (ASPECT_RATIO === '16:9') ? '56.25%' : '177.7777%';

    // VTurb mount
    const mount = document.getElementById('vturbMount');
    const tag   = document.createElement('vturb-smartplayer');
    tag.id = 'vid-' + VTURB_PLAYER_ID;
    tag.style.cssText = 'display:block;margin:0 auto;width:100%;max-width:480px;height:100%';
    mount.appendChild(tag);
    const s = document.createElement('script');
    s.src = `https://scripts.converteai.net/${VTURB_ACCOUNT_ID}/players/${VTURB_PLAYER_ID}/v4/player.js`;
    s.async = true;
    document.head.appendChild(s);

        // Gate logic (mesmo padrÃ£o da pÃ¡gina em portuguÃªs)
    const contribBlock = document.getElementById('solidario');
    const receiveBlock = document.getElementById('receiveBlock');

    if (!contribBlock || !receiveBlock) {
      console.warn("Gate blocks not found");
    } else if (
      sessionStorage.getItem(STORAGE_KEY) === '1' ||
      localStorage.getItem(STORAGE_KEY_LOCAL) === '1'
    ) {
      // JÃ¡ destravou em visita anterior: mostra tudo de uma vez
      contribBlock.classList.remove('hidden');
      receiveBlock.classList.remove('hidden');
    } else {
      let started      = false;
      let seconds      = 0;
      let timer        = null;
      let contribShown = false;
      let reportShown  = false;

      function salvarDestravado() {
        sessionStorage.setItem(STORAGE_KEY, '1');
        localStorage.setItem(STORAGE_KEY_LOCAL, '1');
      }

      function tentarPararTimer() {
        if (contribShown && reportShown && timer) {
          salvarDestravado();
          clearInterval(timer);
          timer = null;
        }
      }

      function tick() {
        seconds++;

        if (!contribShown && seconds >= UNLOCK_CONTRIB_SECONDS) {
          contribBlock.classList.remove('hidden');
          contribShown = true;
          tentarPararTimer();
        }

        if (!reportShown && seconds >= UNLOCK_REPORT_SECONDS) {
          receiveBlock.classList.remove('hidden');
          reportShown = true;
          tentarPararTimer();
        }
      }

      function startCount() {
        if (started) return;
        started = true;
        timer   = setInterval(tick, 1000);
      }

      // ComeÃ§a a contar quando o player realmente comeÃ§a (VTurb)
      window.addEventListener('message', (ev) => {
        const d = ev.data;
        if (!d) return;
        const name = typeof d === 'string' ? d : (d.event || d.type || d.name);
        if (
          name &&
          (name.toLowerCase().includes('play') ||
           name.toLowerCase().includes('started'))
        ) {
          startCount();
        }
      });

      // Backup: primeiro clique no player
      mount.addEventListener('click', startCount, { once: true });

      // Fallback suave: se nada disparar em 15s, comeÃ§a a contar mesmo assim
      setTimeout(() => {
        if (!started) startCount();
      }, 15000);
    }


    // ===== contribution logic + tiers/impact =====
    const MIN = 9, MAX = 500;
    const input = document.getElementById('valorSolidario');
    const btn   = document.getElementById('solidarioBtn');
    const chips = [...document.querySelectorAll('#solidario .chip')];

    const tierExplain = document.getElementById('tierExplain');
    const impactLine  = document.getElementById('impactLine');

    const qs  = new URLSearchParams(location.search);
    const ref = qs.get('ref') || qs.get('aff');
    const refPart = ref ? `&ref=${encodeURIComponent(ref)}` : '';
    let session_id = localStorage.getItem('session_id') || `sess-${Date.now()}`;
    localStorage.setItem('session_id', session_id);

    function tierFor(amount){
      if (amount >= 49) return {emoji:'ğŸŒ•', name:'Complete Patron',    line:'You fund full delivery and growth.'};
      if (amount >= 29) return {emoji:'ğŸ”¥', name:'Transforming Donor', line:'You help someone change today.'};
      if (amount >= 19) return {emoji:'ğŸ”º', name:'Committed Donor',    line:'You amplify the signal.'};
      return              {emoji:'ğŸŒ±', name:'Seed Donor',              line:'You keep the light on.'};
    }

    function renderAmount(amt){
      btn.textContent = `Contribute $${amt.toFixed(0)} â†’`;
      const t = tierFor(amt);
      tierExplain.innerHTML = `${t.emoji} <strong>${t.name}</strong> â€” ${t.line}`;
      const reached = Math.max(1, Math.floor(amt/5)) * 1000;
      impactLine.innerHTML = `Every <strong>$5</strong> helps us reach about <strong>1,000 new people</strong>. Your amount â‰ˆ <strong>${reached.toLocaleString()}</strong> people reached.`;
    }

    function clamp(val){
      const n = Math.floor(Number(val));
      if (Number.isNaN(n)) return null;
      return Math.min(MAX, Math.max(MIN, n));
    }

    chips.forEach(c => c.addEventListener('click', () => {
      const clamped = clamp(c.dataset.v);
      input.value = clamped;
      btn.disabled = false;
      renderAmount(clamped);
    }));

    input.addEventListener('input', () => {
      if (input.value === '') {
        btn.disabled = true;
        btn.textContent = 'Enter an amount';
        tierExplain.textContent = '';
        impactLine.textContent = '';
        return;
      }
      const n = Number(input.value);
      if (!Number.isFinite(n)) return;
      const preview = Math.min(MAX, Math.max(0, Math.floor(n)));
      btn.disabled = preview < MIN;
      if (preview >= MIN) renderAmount(preview);
    });

    input.addEventListener('blur', () => {
      const clamped = clamp(input.value ?? '');
      const finalVal = clamped ?? MIN;
      input.value = finalVal;
      btn.disabled = false;
      renderAmount(finalVal);
    });

        // ===== Clique no botÃ£o de contribuiÃ§Ã£o (checkout Stripe + pixels) =====
    async function goStripeCheckout() {
      const clamped = clamp(input.value ?? '');
      const amount  = clamped ?? MIN;

      // META PIXEL â€“ InitiateCheckout
      try {
        if (typeof fbq === 'function') {
          fbq('track', 'InitiateCheckout', {
            value: amount,
            currency: 'USD', // se quiser manter BRL, Ã© sÃ³ trocar
            content_name: 'Checkout - Quiz EN',
            content_category: 'quiz_checkout_en'
          });
        }
      } catch (e) {
        console.warn('Erro ao disparar fbq InitiateCheckout EN:', e);
      }

      // GA4 / Google Ads â€“ begin_checkout
      try {
        if (typeof gtag === 'function') {
          gtag('event', 'begin_checkout', {
            currency: 'USD',
            value: amount,
            items: [{
              item_id: 'quiz_plan_en',
              item_name: 'Soul Map Diagnosis EN',
              item_category: 'checkout_en'
            }]
          });
        }
      } catch (e) {
        console.warn('Erro ao disparar gtag begin_checkout EN:', e);
      }

      const body = {
        session_id,
        amount,
        tipo: "completo",
        locale: "en",
        ref: qs.get("ref") || qs.get("aff") || null
      };

      try {
        btn.disabled = true;
        btn.textContent = "Creating secure sessionâ€¦";

        const res = await fetch("/api/stripe/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        const data = await res.json();
        if (data && data.url) {
          window.location.href = data.url; // âœ… vai direto pro checkout Stripe
        } else {
          alert("Something went wrong. Please try again.");
          btn.disabled = false;
          btn.textContent = `Contribute $${amount} â†’`;
        }
      } catch (e) {
        console.error(e);
        alert("Error creating Stripe session.");
        btn.disabled = false;
        btn.textContent = `Contribute $${amount} â†’`;
      }
    }

    btn.addEventListener('click', goStripeCheckout);

    // initial state
    (function init(){
      const initVal = clamp(input.value) ?? MIN;
      input.value = initVal;
      btn.disabled = false;
      renderAmount(initVal);
    })();
  });
  </script>
</body>
</html>
