<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Código da Harmonia — Aula Secreta</title>
  <meta name="description" content="Aula secreta do Código da Harmonia. Assista e veja o método na prática.">
  <style>
    :root{ --bg:#0c0a09; --fg:#e7e5e4; --muted:#a8a29e; --brand:#eab308; --card:#13110f; --maxw:980px; }
    *{ box-sizing:border-box }
    html,body{ margin:0; background:var(--bg); color:var(--fg); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif }
    .wrap{ max-width:var(--maxw); margin:0 auto; padding:20px }
    .center{ text-align:center }
    h1{ margin:16px 0 4px; font-size:30px; line-height:1.15; font-weight:800 }
    .sub{ margin:0 0 12px; color:#e7e5e4; opacity:.95 }

    /* Player responsivo — iOS-safe (ajustado para 9:16) */
    .player-box{ position:relative; background:#000; border-radius:14px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.4) }
    .ratio{ height:0; padding-top:177.7777%; } /* 9:16 — se mudar pra 16:9 use 56.25% */
    .player-box iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; display:block }

    /* CTA */
    .cta-area{ margin:18px 0 8px; display:flex; justify-content:center }
    .btn{
      appearance:none; border:0; border-radius:999px; padding:14px 22px; cursor:pointer;
      background:var(--brand); color:#1c1917; font-weight:700; font-size:16px; letter-spacing:.2px;
      box-shadow:0 6px 20px rgba(234,179,8,.25);
    }
    .hint{ color:var(--muted); font-size:.95rem; text-align:center }
    .hidden{ display:none !important }

    /* Bio */
    .card{ background:var(--card); border:1px solid #1c1917; border-radius:14px; padding:18px; margin-top:28px }
    .bio h3{ margin:0 0 6px; font-size:20px }
    .bio p{ margin:0; color:var(--muted) }
    .avatar{
      width:160px; height:160px; object-fit:cover; border-radius:100%;
      margin:-70px auto 16px; border:2px solid #2d2a28; display:block; box-shadow:0 10px 25px rgba(0,0,0,.35)
    }
    .bio-top-spacer{ height:56px }
    .footer{ color:#78716c; font-size:.85rem; margin:40px 0; text-align:center }

    /* ===== POPUP ===== */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{width:92vw;max-width:520px;background:#141211;border:1px solid #262320;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .modal header{padding:18px 18px 10px}
    .modal h3{margin:0;font-size:20px}
    .modal .subm{margin:6px 0 0 0;color:var(--muted);font-size:14px}
    .modal .content{padding:12px 18px 18px}
    .modal label{display:block;font-size:13px;margin:12px 0 6px}
    .modal input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #2b2724;background:#181614;color:var(--fg)}
    .modal .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:18px}
    .modal .cancel{background:transparent;color:var(--fg);border:1px solid #2b2724}
    .modal .error{color:#fca5a5;font-size:13px;margin-top:6px;display:none}
    .close-x{position:absolute;right:10px;top:10px;background:transparent;border:0;color:#a9a29d;font-size:20px;cursor:pointer}
    .show{display:flex}
  </style>
</head>
<body>
  <header class="wrap center">
    <h1>Código da Harmonia</h1>
    <p class="sub">mapa revelado</p>
  </header>

  <main class="wrap">
    <!-- PLAYER (opção #2: IFRAME, mais estável) -->
    <section class="player-box">
      <div class="ratio"></div>
      <script>
        (function(){
          var s=document.createElement("script");
          s.src="https://scripts.converteai.net/lib/js/smartplayer-wc/v4/sdk.js";
          s.async=true; document.head.appendChild(s);
        })();
      </script>
      <iframe
        id="ifr_68fbab9e0daa4ea4dd6dbddd"
        allowfullscreen
        referrerpolicy="origin"
        src="about:blank"
        onload="this.onload=null; this.src='https://scripts.converteai.net/ab0d5dbd-353e-4147-a5c6-52ab96121828/players/68fbab9e0daa4ea4dd6dbddd/v4/embed.html'+(location.search||'?')+'&vl='+encodeURIComponent(location.href)">
      </iframe>
    </section>

    <!-- CTA (um único botão → abre POPUP) -->
    <section class="cta-area center hidden" id="ctaBox">
      <button id="cta" class="btn">QUERO COMEÇAR MINHA TRAVESSIA</button>
    </section>
    <p class="hint" id="timerHint"></p>

    <!-- BIO -->
    <section id="bio" class="card bio center">
      <div class="bio-top-spacer"></div>
      <img class="avatar" src="https://canvaspiritual.com/wp-content/uploads/2025/10/IMG_4316.jpg" alt="Gustavo Prado">
      <h3>Gustavo Prado</h3>
      <p><em>Engenheiro e Pesquisador</em></p>
      <div style="height:14px"></div>
      <p>Após anos construindo casas e estruturando equipes no mundo físico, descobri que a verdadeira engenharia era a da alma.
      Foram mais de 10 anos de estudos em comportamento humano, espiritualidade e engenharia emocional, até decifrar o código que revelo nesta aula —
      uma estrutura que transformou crises, remédios e vícios em propósito, cura e identidade.</p>
    </section>

    <div class="footer">© Canva Espiritual — Engenharia da Consciência</div>
  </main>

  <!-- ===== MODAL / POPUP ===== -->
  <div id="checkoutModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="ttl">
      <button class="close-x" aria-label="Fechar" id="closeX">×</button>
      <header>
        <h3 id="ttl">Crie seu acesso no Engenharia da Consciência</h3>
        <p class="subm"></p>
      </header>
      <div class="content">
        <form id="accessForm" novalidate>
          <label for="name">Nome completo</label>
          <input id="name" name="name" type="text" placeholder="Insira seu nome completo" autocomplete="name" required>

          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="Insira seu melhor e-mail" autocomplete="email" inputmode="email" required>

          <label for="phone">WhatsApp</label>
          <input id="phone" name="phone" type="tel" placeholder="(00) 00000-0000" autocomplete="tel" inputmode="numeric" required>

          <div id="err" class="error">Verifique os campos. O WhatsApp deve ter DDD e 9 dígitos (ex.: (11) 98888-7777).</div>

          <div class="actions">
            <button type="button" class="btn cancel" id="cancel">Cancelar</button>
            <button type="submit" class="btn">Continuar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    /* ====== CONFIG GERAL ====== */
    const VIDEO_ID = '68fbab9e0daa4ea4dd6dbddd';
    const REVEAL_AT_SECONDS = 1817; // 30:17 (timeline do vídeo)
    const STORAGE_KEY = `vturb_progress_${VIDEO_ID}`;

    /* ====== CONFIG KIWIFY ====== */
    const KIWIFY_BASE = 'https://pay.kiwify.com.br/otZkPSG';
    const COUPON = 'CODIGO10';

    /* ====== ELEMENTOS ====== */
    const ctaBox   = document.getElementById('ctaBox');
    const ctaBtn   = document.getElementById('cta');
    const timerHint= document.getElementById('timerHint');

    const modal    = document.getElementById('checkoutModal');
    const openBtn  = ctaBtn; // CTA abre o modal
    const closeBtn = document.getElementById('closeX');
    const cancelBtn= document.getElementById('cancel');
    const form     = document.getElementById('accessForm');
    const nameEl   = document.getElementById('name');
    const emailEl  = document.getElementById('email');
    const phoneEl  = document.getElementById('phone');
    const errEl    = document.getElementById('err');

    /* ====== FUNÇÕES POPUP ====== */
    function openModal(){
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      setTimeout(()=> nameEl.focus(), 50);
      document.documentElement.style.overflow='hidden';
      document.body.style.overflow='hidden';
    }
    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      document.documentElement.style.overflow='';
      document.body.style.overflow='';
    }
    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeModal(); });

    /* ====== MÁSCARA WHATSAPP ====== */
    function formatPhoneNumber(){
      let v = phoneEl.value.replace(/\D/g,'');
      if (v.length > 11) v = v.slice(0,11);
      if (v.length > 2) v = `(${v.slice(0,2)}) ${v.slice(2)}`;
      if (v.length > 10) v = `${v.slice(0,10)}-${v.slice(10)}`;
      phoneEl.value = v;
    }
    function digitsOnly(){ return phoneEl.value.replace(/\D/g,''); }
    phoneEl.addEventListener('focus', formatPhoneNumber);
    phoneEl.addEventListener('keyup', formatPhoneNumber);
    phoneEl.addEventListener('blur', formatPhoneNumber);

    /* ====== SUBMIT → REDIRECIONA ====== */
    function isValidEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email); }
    function isValidPhoneDigits(d){ return d.length === 11; } // 2 DDD + 9 dígitos

    form.addEventListener('submit', function(e){
      e.preventDefault();
      errEl.style.display='none';

      const name  = nameEl.value.trim();
      const email = emailEl.value.trim().toLowerCase();
      let phone   = digitsOnly(); // só números

      if (!name || !isValidEmail(email) || !isValidPhoneDigits(phone)){
        errEl.style.display='block';
        return;
      }
      if (!phone.startsWith('55')) phone = '55' + phone;

      const url = `${KIWIFY_BASE}?coupon=${encodeURIComponent(COUPON)}&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}`;
      window.location.href = url;
    });

    /* ====== DELAY DO CTA POR TEMPO DE VÍDEO ====== */
    function showCTA(){
      if (ctaBox.classList.contains('hidden')){
        ctaBox.classList.remove('hidden');
        if (timerHint) timerHint.textContent = '';
      }
    }
    function saveProgress(sec){
      try { localStorage.setItem(STORAGE_KEY, String(Math.floor(sec))); } catch(e){}
    }
    function getProgress(){
      try { return parseInt(localStorage.getItem(STORAGE_KEY) || '0', 10); } catch(e){ return 0; }
    }

    // Desbloqueio imediato se já passou do tempo antes
    if (getProgress() >= REVEAL_AT_SECONDS) showCTA();

    // Ouvir o tempo do vídeo via postMessage
    function extractSeconds(data){
      if (!data || typeof data !== 'object') return null;
      const keys = ['currentTime','time','seconds','position','current_time'];
      for (const k of keys){ if (k in data && isFinite(Number(data[k]))) return Number(data[k]); }
      if (data.payload && typeof data.payload === 'object'){
        for (const k of keys){ if (k in data.payload && isFinite(Number(data.payload[k]))) return Number(data.payload[k]); }
      }
      return null;
    }

    window.addEventListener('message', (event)=>{
      try{
        const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
        const sec = extractSeconds(data);
        if (sec != null){
          saveProgress(sec);
          if (sec >= REVEAL_AT_SECONDS) showCTA();
        }
      }catch(e){}
    });

    // Fallback gentil (se nenhum evento chegar)
    setTimeout(()=>{
      if (!ctaBox.classList.contains('hidden')) return;
      let elapsed = getProgress();
      const t = setInterval(()=>{
        if (!ctaBox.classList.contains('hidden')) { clearInterval(t); return; }
        elapsed += 1; saveProgress(elapsed);
        if (elapsed >= REVEAL_AT_SECONDS){ clearInterval(t); showCTA(); }
      }, 1000);
    }, 5000);
  </script>
</body>
</html>
